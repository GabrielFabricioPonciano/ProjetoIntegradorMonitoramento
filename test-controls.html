<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Autom√°tico - Controles de Per√≠odo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .test-section {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
        }

        .passed {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .failed {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .pending {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background: #0056b3;
        }

        #results {
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>

<body>
    <h1>üß™ Teste Autom√°tico - Controles de Per√≠odo</h1>

    <div class="test-section">
        <h2>Status do Dashboard</h2>
        <button onclick="checkDashboardStatus()">Verificar Status</button>
        <div id="dashboard-status" class="test-result pending">Aguardando verifica√ß√£o...</div>
    </div>

    <div class="test-section">
        <h2>Elementos da Interface</h2>
        <button onclick="checkElements()">Verificar Elementos</button>
        <div id="elements-status" class="test-result pending">Aguardando verifica√ß√£o...</div>
    </div>

    <div class="test-section">
        <h2>Event Listeners</h2>
        <button onclick="checkEventListeners()">Verificar Event Listeners</button>
        <div id="events-status" class="test-result pending">Aguardando verifica√ß√£o...</div>
    </div>

    <div class="test-section">
        <h2>Teste Funcional - Bot√£o Personalizado</h2>
        <button onclick="testCustomButton()">Testar Bot√£o Personalizado</button>
        <div id="custom-button-status" class="test-result pending">Aguardando teste...</div>
    </div>

    <div class="test-section">
        <h2>Teste Funcional - Bot√µes R√°pidos</h2>
        <button onclick="testQuickButtons()">Testar Bot√µes R√°pidos</button>
        <div id="quick-buttons-status" class="test-result pending">Aguardando teste...</div>
    </div>

    <div class="test-section">
        <h2>Teste Funcional - Slider</h2>
        <button onclick="testSlider()">Testar Slider</button>
        <div id="slider-status" class="test-result pending">Aguardando teste...</div>
    </div>

    <div class="test-section">
        <h2>Teste Completo Autom√°tico</h2>
        <button onclick="runFullTest()">Executar Teste Completo</button>
        <div id="full-test-status" class="test-result pending">Aguardando teste...</div>
    </div>

    <div class="test-section">
        <h2>Resultados Detalhados</h2>
        <div id="results"
            style="max-height: 400px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 4px;"></div>
    </div>

    <script>
        let testResults = {
            dashboard: null,
            elements: null,
            events: null,
            customButton: null,
            quickButtons: null,
            slider: null,
            fullTest: null
        };

        function updateResult(elementId, status, message) {
            const element = document.getElementById(elementId);
            element.className = `test-result ${status}`;
            element.textContent = message;
        }

        function log(message) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        function checkDashboardStatus() {
            log('=== CHECKING DASHBOARD STATUS ===');

            try {
                const dashboardExists = typeof window.dashboard !== 'undefined';
                log('Dashboard exists: ' + dashboardExists);

                if (dashboardExists) {
                    const methods = ['start', 'applyCustomPeriod', 'setQuickPeriod', 'showCustomPeriodPanel', 'hideCustomPeriodPanel'];
                    methods.forEach(method => {
                        const exists = typeof window.dashboard[method] === 'function';
                        log(`Method ${method}: ${exists}`);
                    });

                    testResults.dashboard = true;
                    updateResult('dashboard-status', 'passed', 'Dashboard carregado com sucesso');
                } else {
                    testResults.dashboard = false;
                    updateResult('dashboard-status', 'failed', 'Dashboard n√£o encontrado');
                }
            } catch (error) {
                log('Error checking dashboard: ' + error.message);
                testResults.dashboard = false;
                updateResult('dashboard-status', 'failed', 'Erro ao verificar dashboard: ' + error.message);
            }
        }

        function checkElements() {
            log('=== CHECKING ELEMENTS ===');

            const elements = {
                'period-custom': document.getElementById('period-custom'),
                'custom-period-panel': document.getElementById('custom-period-panel'),
                'period-slider': document.getElementById('period-slider'),
                'slider-value': document.getElementById('slider-value'),
                'quick-buttons': document.querySelectorAll('.quick-period-btn')
            };

            let allFound = true;

            for (const [name, element] of Object.entries(elements)) {
                if (name === 'quick-buttons') {
                    const found = element.length > 0;
                    log(`${name}: ${element.length} found`);
                    if (!found) allFound = false;
                } else {
                    const found = element !== null;
                    log(`${name}: ${found ? 'found' : 'NOT FOUND'}`);
                    if (!found) allFound = false;
                }
            }

            testResults.elements = allFound;
            updateResult('elements-status', allFound ? 'passed' : 'failed',
                allFound ? 'Todos os elementos encontrados' : 'Alguns elementos n√£o encontrados');
        }

        function checkEventListeners() {
            log('=== CHECKING EVENT LISTENERS ===');

            // Esta √© uma verifica√ß√£o b√°sica - na pr√°tica seria mais complexo
            const customButton = document.getElementById('period-custom');
            const quickButtons = document.querySelectorAll('.quick-period-btn');
            const slider = document.getElementById('period-slider');

            let listenersOk = true;

            if (customButton) {
                // Verificar se tem algum event listener (b√°sico)
                log('Custom button has listeners: checking...');
            } else {
                log('Custom button not found');
                listenersOk = false;
            }

            if (quickButtons.length > 0) {
                log(`Quick buttons found: ${quickButtons.length}`);
            } else {
                log('No quick buttons found');
                listenersOk = false;
            }

            if (slider) {
                log('Slider found');
            } else {
                log('Slider not found');
                listenersOk = false;
            }

            testResults.events = listenersOk;
            updateResult('events-status', listenersOk ? 'passed' : 'failed',
                listenersOk ? 'Event listeners parecem estar configurados' : 'Problemas com event listeners');
        }

        function testCustomButton() {
            log('=== TESTING CUSTOM BUTTON ===');

            const customButton = document.getElementById('period-custom');
            const panel = document.getElementById('custom-period-panel');

            if (!customButton || !panel) {
                log('Custom button or panel not found');
                testResults.customButton = false;
                updateResult('custom-button-status', 'failed', 'Elementos n√£o encontrados');
                return;
            }

            const initialDisplay = panel.style.display;
            log('Initial panel display: ' + initialDisplay);

            // Simular clique
            customButton.click();

            setTimeout(() => {
                const afterClickDisplay = panel.style.display;
                log('After click panel display: ' + afterClickDisplay);

                const success = afterClickDisplay === 'block';
                testResults.customButton = success;
                updateResult('custom-button-status', success ? 'passed' : 'failed',
                    success ? 'Bot√£o personalizado funciona' : 'Bot√£o personalizado n√£o mostra painel');
            }, 100);
        }

        function testQuickButtons() {
            log('=== TESTING QUICK BUTTONS ===');

            const quickButtons = document.querySelectorAll('.quick-period-btn');
            const slider = document.getElementById('period-slider');
            const sliderValue = document.getElementById('slider-value');

            if (quickButtons.length === 0) {
                log('No quick buttons found');
                testResults.quickButtons = false;
                updateResult('quick-buttons-status', 'failed', 'Bot√µes r√°pidos n√£o encontrados');
                return;
            }

            const firstButton = quickButtons[0];
            const days = firstButton.getAttribute('data-days');
            log('Testing button with ' + days + ' days');

            // Simular clique
            firstButton.click();

            setTimeout(() => {
                const isActive = firstButton.classList.contains('active');
                log('Button active: ' + isActive);

                let sliderUpdated = false;
                if (slider && sliderValue) {
                    const sliderVal = slider.value;
                    const displayVal = sliderValue.textContent;
                    sliderUpdated = sliderVal === days && displayVal === days;
                    log('Slider updated: ' + sliderUpdated + ' (value: ' + sliderVal + ', display: ' + displayVal + ')');
                }

                const success = isActive && sliderUpdated;
                testResults.quickButtons = success;
                updateResult('quick-buttons-status', success ? 'passed' : 'failed',
                    success ? 'Bot√µes r√°pidos funcionam' : 'Bot√µes r√°pidos t√™m problemas');
            }, 200);
        }

        function testSlider() {
            log('=== TESTING SLIDER ===');

            const slider = document.getElementById('period-slider');
            const sliderValue = document.getElementById('slider-value');

            if (!slider || !sliderValue) {
                log('Slider elements not found');
                testResults.slider = false;
                updateResult('slider-status', 'failed', 'Elementos do slider n√£o encontrados');
                return;
            }

            const testValue = '42';
            slider.value = testValue;

            // Disparar evento input
            const inputEvent = new Event('input', { bubbles: true });
            slider.dispatchEvent(inputEvent);

            setTimeout(() => {
                const displayValue = sliderValue.textContent;
                log('Slider display value: ' + displayValue);

                const success = displayValue === testValue;
                testResults.slider = success;
                updateResult('slider-status', success ? 'passed' : 'failed',
                    success ? 'Slider funciona' : 'Slider n√£o atualiza display');
            }, 100);
        }

        async function runFullTest() {
            log('=== RUNNING FULL AUTOMATED TEST ===');

            // Reset results
            Object.keys(testResults).forEach(key => testResults[key] = null);

            // Run all tests in sequence
            checkDashboardStatus();
            await sleep(500);

            checkElements();
            await sleep(500);

            checkEventListeners();
            await sleep(500);

            testCustomButton();
            await sleep(1000);

            testQuickButtons();
            await sleep(1000);

            testSlider();
            await sleep(1000);

            // Calculate final result
            const allTests = Object.values(testResults);
            const passedTests = allTests.filter(result => result === true).length;
            const totalTests = allTests.length;
            const successRate = (passedTests / totalTests) * 100;

            log(`\n=== FINAL RESULTS ===`);
            log(`Passed: ${passedTests}/${totalTests}`);
            log(`Success rate: ${successRate.toFixed(1)}%`);

            const overallSuccess = successRate >= 80; // 80% success threshold
            testResults.fullTest = overallSuccess;

            updateResult('full-test-status', overallSuccess ? 'passed' : 'failed',
                overallSuccess ? `Teste completo passou (${successRate.toFixed(1)}%)` :
                    `Teste completo falhou (${successRate.toFixed(1)}%)`);

            if (overallSuccess) {
                log('üéâ ALL CRITICAL TESTS PASSED!');
            } else {
                log('‚ùå SOME CRITICAL TESTS FAILED');
                log('Failed tests:');
                Object.entries(testResults).forEach(([test, result]) => {
                    if (result === false) {
                        log(`  - ${test}`);
                    }
                });
            }
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Auto-run basic checks when page loads
        window.addEventListener('load', () => {
            log('Test page loaded - running basic checks...');
            checkDashboardStatus();
            checkElements();
        });
    </script>
</body>

</html>